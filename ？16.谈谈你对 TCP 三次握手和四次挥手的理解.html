<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TCP 三次握手和四次挥手的理解</title>
</head>
<body>
    <pre>

        三次握手：
                    你能听到我说话嘛？
                    我听的到，你能听到我嘛？
                    我也能听到你说话。

                    客户端发送SYN包，进入SYN_SEND状态
                    服务端接受并确认，发送自己的SYN+ACK包，进入SYN_RECV状态
                    客户端接受包，发送ACK确认包，双方进入ESTABLISHED


                    为什么需要三次握手：
                        
                        防止已失效的请求，又传送到服务端，造成资源的浪费。
                        
                    为什么不是两次/四次握手：
                        两次握手不可靠，服务端不能确定客服端是否可以接受到自己

                        三次握手就已经能够确认连接，四次握手会浪费资源与时间

                    第三次握手报文丢失后：
                        服务端会重复发送一定次数的SYN+ACK，重复发送后仍未收到ACK应答后，就会关闭连接
                        此时客户端已经进入established状态，当客户端向服务端发送请求时，服务端会以RST包响应，进入CLOSED状态，客户端收到后，会关闭接口（有待验证）

        四次挥手：

                    客户端：我要关闭了；
                    服务端：我知道了；
                    服务端：我也要关闭了；
                    客户端：好的，我等下就关了。

                    客户端发送连接释放报文，进入Fin-wait-1状态；
                    服务端收到报文后，发送确认报文，进入close-wait状态，
                    客户端收到确认报文，进入fin-wait-2状态
                    服务端发送连接释放报文；
                    客户端接收报文，进入time-wait状态，并发送确认报文给服务端，等待2MSL（最长报文段的 寿命时间）时间；
                    服务端接收确认报文，关闭连接。


                    客户端为什么要等待2MSL时间：
                        防止确认报文丢失。服务端接收不到确认报文时，会重复发送释放连接报文，客户端收到后，会再次发送确认报文，并再次等待2MSL。
                        如果2MSL时间内没收到服务端的释放连接报文，就关闭连接。

    </pre>
</body>
</html>